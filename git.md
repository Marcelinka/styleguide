# Работа с репозиторием

### Git

<p><details><summary>В проекте должно быть 2 дефолтные ветки: <code>master</code> и <code>develop</code></summary></br>

`master` - ветка, используемая для релизов, production собирается именно с нее. Если принято правило об использовании тегов, то теги должны создаваться именно с этой ветки.

`develop` - дефолтная ветка для подготовки релиза. Должна быть стабильной. С нее собирается предрелизный стейдж. Все дочерние ветки перед влитием должны проходить стадию тестирования.

</details></p>

<p><details><summary>В проекте могут быть дефолтные ветки, отличные от <code>master</code> и <code>develop</code> для мажорных изменений</summary></br>

Если планируется мажорное изменение, которое будет разрабатываться длительное время несколькими людьми, и это мажорное изменение может заехать в релиз только целиком, то создается дефолтная ветка от `develop`, которая отвечает за это мажорное изменение. Например: `redesign` - для нового дизайна.

Она считается дочерней для `develop`, и когда она будет готовиться к релизу, то ее сначала нужно влить в `develop`, а только потом в `master`.

Такие дефолтные ветки считаются временными и должны удаляться после релиза.

</details></p>

<p><details><summary>В дефолтных ветках не ведется активная работа, в них нельзя пушить напрямую</summary></br>

Для любых изменений нужно создавать дочернюю ветку от дефолтной, проводить изменения там и создавать MR/PR.

Исключение только для тех. лида, для быстрого фикса бага он может залить фикс напрямую в `develop`, для ветки `master` исключений нет ни для кого, строго запрещено вливать что-то напрямую в `master`.

</details></p>

<p><details><summary>Для всех остальных работ создаются рабочие ветки, желательно в названии указать id задачи</summary></br>

Для обычных задач это дочерняя ветка `develop`, для подзадачи мажорного изменения - дочерняя ветка дефолтной ветки для этой мажорки.

</details></p>

<p><details><summary>Рефакторинг должен проводиться в отдельных ветках</summary></br>

Мелкий рефакторинг допускается оставить в рамках обычной рабочей ветки, при условии, что это небольшая задача и она должна заехать быстро.

Рефакторинг должен заезжать в ветку `develop` как можно быстрее, именно поэтому его стоит выносить в отдельную рабочую ветку и сначала сделать изменения по всему проекту, а потом осуществлять их в своей задаче.

Если по какой-то причине рефакторинг долго лежит, то начинают накапливаться новые изменения, сделанные по старому стандарту, и постоянно приходится проводить двойную работу по переделке.

</details></p>

- Коммиты должны быть атомарными, желательно использовать какой-то шаблон для названия (например [conventional commits](https://www.conventionalcommits.org/en/v1.0.0/#summary))
- Рабочие ветки должны удаляться после мержа и не использоваться в дальнейшем
- Периодически стоит чистить уже удаленные ветки, можно использовать [подобный пакет](https://github.com/nemisj/git-removed-branches)

### Gitlab

- `ci/cd` должен быть настроен на автоматический запуск всех проверочных команд (EsLint/TsLint, Prettier, StyleLint, Jest и т.д.)
- Если сборка происходит через `ci/cd`, то она должна поддерживать 3 варианта сборки: релизная с ветки `master`, предрелизная с ветки `develop`, тестовая с любой ветки
- Сборка не должна быть возможна, если линтеры/unit-тесты упали
- `merge` проводится только с помощью MR, не вручную
- Если pipeline упал, не должно быть возможности смержить
- `push` в `master` и `develop` возможен только для уровня maintainer
